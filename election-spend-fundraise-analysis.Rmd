---
title: "election-spend-fundraise-analysis"
author: "Will Schrepferman"
date: "11/14/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(dplyr)
library(readxl)
library(janitor)
library(ggplot2)
```

```{r scrape-results}
# PRESIDENTIAL
# Sources: 2020 - Cook Political Report: https://cookpolitical.com/2020-national-popular-vote-tracker
#          2016 - FEC: https://www.fec.gov/documents/1890/federalelections2016.xlsx

# 2020 presidential results:

pres_2020 <- read_csv("Popular vote backend - Sheet1.csv") %>%
  clean_names() %>%
  select(stateid, dem_percent, rep_percent) %>%
  mutate(dem_percent2020 = str_replace_all(dem_percent, "%", " "), rep_percent2020 = str_replace_all(rep_percent, "%", " ")) %>%
  mutate(state = stateid, d_percent2020 = as.numeric(dem_percent2020), r_percent2020 = as.numeric(rep_percent2020)) %>%
  select(state, d_percent2020, r_percent2020) %>%
  arrange(state) %>%
  filter(state != "NA")

# 2016 presidential results:

pres_2016 <- read_excel("federalelections2016.xlsx") %>%
  clean_names() %>%
  mutate(state = x1, d_votes = clinton_d_5, r_votes = trump_r_4, total_vote) %>%
  select(state, d_votes, r_votes, total_vote) %>%
  mutate(d_percent2016 = 100*round(d_votes/total_vote, 4), r_percent2016 = 100*round(r_votes/total_vote, 4)) %>%
  select(state, d_percent2016, r_percent2016) %>%
  arrange(state)

full_pres <- left_join(pres_2016, pres_2020, by = "state") %>%
  mutate(margin_16 = (d_percent2016 - r_percent2016),
         margin_20 = (d_percent2020 - r_percent2020),
         
         # margin_diff is the percentage swing towards the Dem candidate from '16 to '20
         
         margin_diff = (margin_20 - margin_16))

```

```{r fundraising}
fundraising_data <- read_csv("raw fec individual contributions by state and date.csv")

# function to extract last x characters of a string
substrRight <- function(x, n){
  substr(x, nchar(x)-n+1, nchar(x))
}

fundraising_data <- fundraising_data %>%
  mutate(year = substrRight(date, 4)) %>%
  mutate(month = substr(date, 1, 1)) %>%
  filter(year == 2020) %>%
  select(recipient, state, date, contribution_amount)

fundraising_data %>%
  group_by(recipient) %>%
  summarise(total = sum(contribution_amount))

pres_fundraising_biden <- fundraising_data %>%
  group_by(recipient, state) %>%
  filter(recipient == "BIDEN FOR PRESIDENT") %>%
  summarise(biden_sum = sum(contribution_amount))

pres_fundraising_trump <- fundraising_data %>%
  group_by(recipient, state) %>%
  filter(recipient == "DONALD J. TRUMP FOR PRESIDENT, INC.") %>%
  summarise(trump_sum = sum(contribution_amount))

nearly_comb_data <- right_join(pres_fundraising_biden, full_pres, by = "state")

comb_data <- right_join(pres_fundraising_trump, nearly_comb_data, by = "state") %>%
  select(state, biden_sum, trump_sum, d_percent2016, margin_diff)


  

```




